\begin{figure}
    \centering
    \begin{tikzpicture}[node distance=0.6cm and 0.6cm,
            input-block/.style={rectangle, draw, fill=red!10!white, text width=2.5cm, minimum height=0.8cm, align=center, rounded corners, drop shadow=gray!50},
            output-block/.style={rectangle, draw, fill=green!20!white, text width=2.6cm, minimum height=0.8cm, align=center, rounded corners, drop shadow=gray!50},
            block/.style={rectangle, draw, fill=accent!20!white, text width=2.0cm, minimum height=0.8cm, align=center, rounded corners, drop shadow=gray!50},
            arrow/.style={thick,->,>=latex},
            doc/.style={draw,thick,align=center,color=black,shape=document,minimum width=20mm-6mm,minimum height=24.2mm-10mm,shape=document,inner sep=1ex,fill=white,drop shadow=gray!50},
            % tool/.style={rectangle, draw, fill=magenta!10, text width=3cm, minimum height=0.8cm, align=center, rounded corners},
            inv/.style={}
        ]

        % Input block
        \node[doc] (input) {Configuration\\[.2em]\textit{.yaml/.json/.py}};

        % Lucid blocks
        \node[block, below=1cm of input] (estimator) {\Circled{2} Estimator};
        \node[block, right=of estimator] (tuner) {\Circled{3} Tuner};
        \node[block, left=of estimator] (sets) {\Circled{1} Safety Specification};
        \node[block, below=of estimator] (feature) {\Circled{4} Feature Map}; % / Barrier template
        \node[block, left=of feature] (optimizer) {\Circled{5} Solver};
        % \node[block, below=of optimizer] (verifier) {Verifier};
        \node[draw, dashed, inner sep=0.25cm, rounded corners,
        % fit=(estimator)(feature)(optimizer)(verifier), label=above:{\textbf{Lucid}}] {};
        fit=(estimator)(feature)(optimizer)(sets)(tuner), label=below:{\textbf{\lucid}}] {};

        % Output block
        % \node[output-block, left=of verifier] (output) {Barrier certificate};
        \node[output-block, below=of optimizer] (output) {Barrier Certificate};
        \node[output-block, below=.5cm of output] (prob) {Safety Probability};
        \node[] at ($(output)!0.5!(prob)$) (plus) {$+$};

        % Smt solvers
        % \node[inv, below=2.5cm of verifier.north, anchor=north] (smtInv) {};
        % \node[tool, left=0.3cm of smtInv] (dreal) {dReal};
        % \node[tool, right=0.3cm of smtInv] (cvc5) {CVC5};
        % \node[draw, dashed, inner sep=0.3cm, rounded corners,
        % fit=(dreal)(cvc5), label=left:{\textbf{SMT Solver}}] {};

        % Arrows
        \draw[arrow] (input) -- (estimator);
        \draw[arrow] ($(input.south)+(0.0,-0.3)$) -| (tuner);
        \draw[arrow] ($(input.south)+(0.0,-0.3)$) -| (sets);
        \draw[arrow] (sets) -- (optimizer);
        \draw[arrow] (tuner) -- (estimator);
        \draw[arrow] (estimator) -- (feature);
        \draw[arrow] (feature) -- (optimizer);
        % \draw[arrow] (optimizer) -- (verifier);
        % \draw[arrow] (verifier) -- (output);
        \draw[arrow] (optimizer) -- (output);

        % \draw[arrow] (cvc5.north) -- (verifier.south);
        % \draw[arrow] (dreal.north) -- (verifier.south);

    \end{tikzpicture}
    \caption{General architecture of \lucid, highlighting its core components and their connections.}
    \label{fig:architecture}
\end{figure}
