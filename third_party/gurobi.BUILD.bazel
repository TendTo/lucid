"""Gurobi library for Bazel"""

load("@rules_cc//cc:defs.bzl", "cc_import", "cc_library")

licenses(["notice"])

filegroup(
    name = "libgurobi.so",
    srcs = glob(["lib/libgurobi*.so"], allow_empty = True, exclude = ["lib/libgurobi*_light.so"]),
)

filegroup(
    name = "gurobi.dll",
    srcs = glob(["bin/gurobi*.dll"], allow_empty = True, exclude = ["bin/gurobi*_light.dll"]),
)

filegroup(
    name = "gurobi.lib",
    srcs = glob(["lib/gurobi*.lib"], allow_empty = True, exclude = ["lib/gurobi_c++*.lib"]),
)

filegroup(
    name = "gurobi.netstandard.lib",
    srcs = glob(["lib/gurobi*.netstandard*.dll"], allow_empty = True),
)

filegroup(
    name = "gurobi_c++md.lib",
    srcs = select({
        "@lucid//tools:release_build": glob(["lib/gurobi_c++md*.lib"], allow_empty = True, exclude = ["lib/gurobi_c++mdd*.lib"]),
        "//conditions:default": glob(["lib/gurobi_c++mdd*.lib"], allow_empty = True),
    }),
)

cc_import(
    name = "_gurobi_c_unix",
    hdrs = ["include/gurobi_c.h"],
    shared_library = ":libgurobi.so",
    visibility = ["//visibility:private"],
)

cc_import(
    name = "_gurobi_cpp_unix",
    hdrs = ["include/gurobi_c++.h", "include/gurobi_c.h"],
    static_library = "lib/libgurobi_c++.a",
    visibility = ["//visibility:private"],
)

cc_import(
    name = "_gurobi_dll_windows",
    shared_library = ":gurobi.dll",
    visibility = ["//visibility:private"],
)

cc_import(
    name = "_gurobi_dll_netstandard_windows",
    shared_library = ":gurobi.netstandard.lib",
    visibility = ["//visibility:private"],
)

cc_import(
    name = "_gurobi_lib_windows",
    hdrs = ["include/gurobi_c++.h", "include/gurobi_c.h"],
    static_library = ":gurobi.lib",
    visibility = ["//visibility:private"],
)

cc_import(
    name = "_gurobi_lib_md_windows",
    static_library = ":gurobi_c++md.lib",
    visibility = ["//visibility:private"],
)

cc_library(
    name = "gurobi",
    deps = select({
        "@platforms//os:windows": [":_gurobi_dll_windows", ":_gurobi_dll_netstandard_windows", ":_gurobi_lib_windows", ":_gurobi_lib_md_windows"],
        "//conditions:default": [":_gurobi_c_unix", ":_gurobi_cpp_unix"],
    }),
    includes = ["include"],
    visibility = ["//visibility:public"],
    linkopts = ["-Wl,-rpath,$GUROBI_HOME/lib"],
)
